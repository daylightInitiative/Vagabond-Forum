{% extends "base.html" %}

{% block content %}

    <!-- <div class="pagebar">
        <p>This is an example post</p>
    </div>
    <div class="bgsquare">
        <div class="square">

        </div>
    </div> -->

    {% if userinfo %}
        <p>Hello, <b>{{ userinfo.username }}</b>! You are user number: {{ userinfo.userid }}<br>Welcome! We appreciate your patronage since {{ userinfo.join_date }}</p>
        {% if is_superuser %}
            <p>As an <b>admin</b>! be sure to use your power to make everyone happy! <b>or else..</b></p>
        {% endif %}
    {% endif %}

    {% if sessions %}
        <button id="sign-out-sessions">Sign out of all other sessions</button>

        <h2>Login Sessions</h2>
        {% for sesh in sessions %}
            <b>Status: {{ 'ACTIVE' if sesh.active else 'INACTIVE' }}</b>
            <p>Session from: {{ sesh.userAgent }} by IP address {{ sesh.ipaddr }} on {{ sesh.lastLogin }}</p>
        {% endfor %}

        <script>
            const signout = document.getElementById("sign-out-sessions");
            
            async function sign_out_of_all_other_sessions() {
                try {

                    const response = await fetch('/invalidate_other_sessions', {
                        method: "POST",
                        body: JSON.stringify({
                        }),
                        headers: {
                            "Content-type": "application/json; charset=UTF-8"
                        }
                    })

                    if (!response.ok) {
                        throw new Error(`Reponse status: ${response.status}`);
                    }
                } catch (error) {
                    console.log(error);
                }
            }

            signout.onclick = function() {
                console.log("signing out of all other sessions...");
                sign_out_of_all_other_sessions();
            };
        </script>
    {% endif %}

{% endblock %}