{% extends "base.html" %}

{% block content %}

    {% if post %}
        <div class="user-post">
            <h2><b>{{ post.title }}</b></h2>
            <p>author: {{ post.author_username }} on {{ post.creation_date }}</p>
            <p>{{ post.contents }}</p>
            <p>{{ post.views }} views</p>
            {% if is_authenticated %}
                <form class="new-post-form" action="{{ request.url }}?reply" method="POST">
                    <input type="hidden" name="post_id" value="{{ post.id }}">
                    <h4>Reply to this post</h4>
                    <textarea id="reply" name="reply" placeholder="Write your reply here" rows="5" cols="50" required></textarea>
                    <br><br>
                    <input type="submit" value="Submit">
                </form>
            {% else %}
                <p>You must log in to leave a reply.</p>
            {% endif %}
        </div>
    {% endif %}

    {% if replies %}
        {% for post in replies %}
            <div class="user-post">
                <h2><b>Reply</b></h2>
                <p>author: {{ post.author_username }} on {{ post.creation_date }}</p>
                <p>{{ post.contents }}</p>
                {% if is_superuser == true %}
                    <!-- display the delete button (a form hack is to have the post_id hidden here) -->
                    <!-- the route is protected -->
                    <form class="delete-post-button" action="{{ request.url }}?reply" method="DELETE">
                        <input type="hidden" name="post_id" value="{{ post.id }}">
                        <button type="submit">Delete Post</button>
                    </form>
                {% endif %}
            </div>
        {% endfor %}
    {% endif %}

{% endblock %}